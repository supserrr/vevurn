# Minimal Backend-only deployment - NO DOCKER
services:
  - type: web
    name: vevurn-backend
    runtime: node
    env: node
    rootDir: ./backend
    buildCommand: |
      echo "=== Backend Node.js Build from /backend directory ==="
      echo "Node version: $(node --version)"
      corepack enable
      corepack prepare pnpm@9.14.4 --activate  
      echo "PNPM version: $(pnpm --version)"
      echo "Working directory: $(pwd)"
      echo "Installing dependencies..."
      cd ..
      pnpm install --no-frozen-lockfile
      echo "Building backend..."
      pnpm --filter @vevurn/backend build
      echo "Build complete!"
    startCommand: |
      echo "=== Starting Backend Service ==="
      echo "Working directory: $(pwd)"
      pnpm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3001
      - key: FORCE_NODE_RUNTIME
        value: "true"
      - key: DISABLE_DOCKER
        value: "true"
