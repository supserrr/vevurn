# Environment Setup Guide

This guide explains how to configure environment variables for both development and production environments.

## üìÅ Environment Files Overview

### Root Level
- **`.env.example`** - Backend environment template
- **`.env.production.template`** - Production-specific template  

### Backend
- **`backend/.env`** - Your local backend configuration (create from `.env.example`)

### Frontend  
- **`frontend/.env.example`** - Frontend environment template
- **`frontend/.env.local`** - Your local frontend configuration (create from `.env.example`)

## üõ†Ô∏è Development Setup

### 1. Backend Environment Setup

```bash
# Copy the example file
cp .env.example backend/.env

# Edit the file with your local settings
nano backend/.env  # or use your preferred editor
```

**Required Settings for Development:**
```env
# Application
NODE_ENV=development
PORT=3001
FRONTEND_URL=http://localhost:3000
BACKEND_URL=http://localhost:3001

# Database (PostgreSQL)
DATABASE_URL="postgresql://postgres:password@localhost:5432/vevurn_pos"

# Redis
REDIS_URL="redis://localhost:6379"

# Better Auth
BETTER_AUTH_SECRET="your-32-character-secret-here"
BETTER_AUTH_URL="http://localhost:3001"

# JWT
JWT_SECRET="your-jwt-secret-key"
JWT_REFRESH_SECRET="your-jwt-refresh-secret-key"
```

### 2. Frontend Environment Setup

```bash
# Navigate to frontend directory
cd frontend

# Copy the example file
cp .env.example .env.local

# Edit the file
nano .env.local
```

**Required Settings for Development:**
```env
# Application
NODE_ENV=development
PORT=3000

# API URLs
NEXT_PUBLIC_API_URL=http://localhost:3001
NEXT_PUBLIC_WS_URL=ws://localhost:3001
BETTER_AUTH_URL=http://localhost:3001

# App Configuration
NEXT_PUBLIC_APP_ENV=development
NEXT_PUBLIC_DEBUG_MODE=true
```

### 3. Generate Required Secrets

```bash
# Generate Better Auth secret
openssl rand -base64 32

# Generate JWT secrets
openssl rand -base64 32  # for JWT_SECRET
openssl rand -base64 32  # for JWT_REFRESH_SECRET
```

### 4. Database Setup

```bash
# Install PostgreSQL locally or use a cloud provider
# For local PostgreSQL setup:
# macOS: brew install postgresql
# Ubuntu: sudo apt install postgresql
# Windows: Download from postgresql.org

# Start PostgreSQL service
brew services start postgresql  # macOS
sudo systemctl start postgresql  # Linux

# Install Redis locally or use a cloud provider
# macOS: brew install redis
# Ubuntu: sudo apt install redis-server

# Start Redis service
brew services start redis  # macOS
redis-server  # Manual start

# Run database migrations
cd backend
pnpm prisma migrate dev
```

## üè≠ Production Setup (Render)

Production environment variables are handled automatically by Render using the `render.yaml` configuration.

### Automatic Variables (No Action Required)
- `DATABASE_URL` - Generated by PostgreSQL service
- `REDIS_URL` - Generated by Redis service  
- `JWT_SECRET` - Auto-generated secure secret
- `JWT_REFRESH_SECRET` - Auto-generated secure secret
- `BETTER_AUTH_SECRET` - Auto-generated secure secret

### Manual Configuration (Required)

After deployment, configure these in the Render dashboard:

#### AWS S3 (File Uploads)
```env
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your_access_key_id
AWS_SECRET_ACCESS_KEY=your_secret_access_key
AWS_S3_BUCKET=vevurn-uploads
```

#### Email/SMTP (Notifications)
```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASS=your_app_password
FROM_EMAIL=noreply@yourdomain.com
```

## üîê Security Best Practices

### Secret Generation
```bash
# Use strong, randomly generated secrets
openssl rand -base64 32

# Different secrets for different environments
# Never reuse development secrets in production
```

### Environment File Security
```bash
# Never commit .env files to git
echo ".env" >> .gitignore
echo "*.env" >> .gitignore
echo ".env.local" >> .gitignore

# Set proper file permissions
chmod 600 .env
chmod 600 frontend/.env.local
```

### Production Security
- Use environment variables for all secrets
- Rotate secrets regularly
- Use different secrets per environment
- Never hardcode secrets in source code

## üåç Environment-Specific Configuration

### Development
```env
NODE_ENV=development
LOG_LEVEL=debug
ENABLE_CORS=true
ENABLE_SWAGGER=true
```

### Staging
```env
NODE_ENV=staging
LOG_LEVEL=info
ENABLE_CORS=true
ENABLE_SWAGGER=false
```

### Production
```env
NODE_ENV=production
LOG_LEVEL=warn
ENABLE_CORS=false
ENABLE_SWAGGER=false
```

## üîß Configuration by Feature

### File Uploads (AWS S3)
```env
# Backend
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your_key
AWS_SECRET_ACCESS_KEY=your_secret
AWS_S3_BUCKET=vevurn-uploads

# Frontend
NEXT_PUBLIC_S3_BUCKET_URL=https://vevurn-uploads.s3.us-east-1.amazonaws.com
NEXT_PUBLIC_ENABLE_FILE_UPLOADS=true
```

### Email Notifications
```env
# Backend
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=notifications@yourdomain.com
SMTP_PASS=your_app_password
FROM_EMAIL=noreply@yourdomain.com

# Frontend
NEXT_PUBLIC_ENABLE_NOTIFICATIONS=true
```

### Analytics & Monitoring
```env
# Frontend
NEXT_PUBLIC_GOOGLE_ANALYTICS_ID=G-XXXXXXXXXX
NEXT_PUBLIC_SENTRY_DSN=https://your-dsn@sentry.io/project
NEXT_PUBLIC_ENABLE_ANALYTICS=true
```

### Payment Processing
```env
# Backend
STRIPE_SECRET_KEY=sk_live_your_secret_key
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret

# Frontend
NEXT_PUBLIC_STRIPE_PUBLIC_KEY=pk_live_your_public_key
```

##  Troubleshooting

### Common Issues

1. **Database Connection Error**
   ```
   Error: connect ECONNREFUSED 127.0.0.1:5432
   ```
   **Solution**: Verify PostgreSQL is running and `DATABASE_URL` is correct

2. **Redis Connection Error**
   ```
   Error: connect ECONNREFUSED 127.0.0.1:6379
   ```
   **Solution**: Verify Redis is running and `REDIS_URL` is correct

3. **CORS Error in Browser**
   ```
   Access to fetch blocked by CORS policy
   ```
   **Solution**: Check `FRONTEND_URL` matches your frontend domain

4. **Auth Errors**
   ```
   Invalid signature / JWT malformed
   ```
   **Solution**: Verify `BETTER_AUTH_SECRET` and JWT secrets are set correctly

### Debug Commands

```bash
# Check environment variables are loaded
cd backend && node -e "console.log(process.env.DATABASE_URL)"

# Test database connection
cd backend && pnpm prisma db push

# Test Redis connection
redis-cli ping

# Check if services are running
curl http://localhost:3001/health
curl http://localhost:3000
```

## üìã Environment Checklist

### Development Setup ‚úÖ
- [ ] Backend `.env` file created and configured
- [ ] Frontend `.env.local` file created and configured
- [ ] Database connection working
- [ ] Redis connection working
- [ ] Secrets generated and configured
- [ ] Services can communicate with each other

### Production Deployment ‚úÖ
- [ ] Render services deployed successfully
- [ ] Database and Redis services are healthy
- [ ] Auto-generated secrets are working
- [ ] Manual environment variables configured (AWS, SMTP, etc.)
- [ ] Health checks passing
- [ ] Frontend can reach backend APIs
- [ ] File uploads working (if enabled)
- [ ] Email notifications working (if enabled)

## üìû Support

- **Environment Issues**: Check this guide and troubleshooting section
- **Render Deployment**: See `docs/RENDER_DEPLOYMENT.md`
- **Database Issues**: Check `docs/DATABASE_SETUP.md` (if exists)
- **AWS S3 Setup**: See `S3_SERVICE_DOCS.md`

Remember to keep your environment files secure and never commit secrets to version control!
